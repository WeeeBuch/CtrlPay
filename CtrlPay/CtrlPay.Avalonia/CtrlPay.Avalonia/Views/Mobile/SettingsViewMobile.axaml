<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:CtrlPay.Avalonia.ViewModels"
             xmlns:styles="using:CtrlPay.Avalonia.Styles"
             xmlns:translations="using:CtrlPay.Avalonia.Translations"
             xmlns:conv="using:CtrlPay.Avalonia.Converters"
             x:Class="CtrlPay.Avalonia.Views.Mobile.SettingsViewMobile"
             Background="{DynamicResource Brush.Background}"
             x:DataType="vm:SettingsViewModel"
             d:DesignWidth="390"
             d:DesignHeight="800"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d">

	<UserControl.Resources>
		<conv:ThemeToColorConverter x:Key="ThemeToColorConverter" />
	</UserControl.Resources>

	<UserControl.Styles>

		<!-- Status colors -->
		<Style Selector="TextBlock.StatusTextBox[Tag=Success]">
			<Setter Property="Foreground" Value="{DynamicResource Brush.Success}"/>
		</Style>
		<Style Selector="TextBlock.StatusTextBox[Tag=Error]">
			<Setter Property="Foreground" Value="{DynamicResource Brush.Error}"/>
		</Style>
		<Style Selector="TextBlock.StatusTextBox[Tag=Testing]">
			<Setter Property="Foreground" Value="{DynamicResource Brush.Warning}"/>
		</Style>
		<Style Selector="TextBlock.StatusTextBox[Tag=None]">
			<Setter Property="Foreground" Value="{DynamicResource Brush.Text.Primary}"/>
		</Style>

		<!-- Dropdown button (our own "expander header") -->
		<Style Selector="ToggleButton.DropdownButton">
			<Setter Property="Background" Value="{DynamicResource Brush.Surface}"/>
			<Setter Property="BorderBrush" Value="{DynamicResource Brush.Outline}"/>
			<Setter Property="BorderThickness" Value="1"/>
			<Setter Property="CornerRadius" Value="12"/>
			<Setter Property="Padding" Value="12"/>
			<Setter Property="HorizontalContentAlignment" Value="Stretch"/>
		</Style>

		<Style Selector="ToggleButton.DropdownButton:pointerover">
			<Setter Property="Background" Value="#2A343F"/>
		</Style>

		<!-- Rotate chevron when opened -->
		<Style Selector="ToggleButton.DropdownButton:checked Path#Chevron">
			<Setter Property="RenderTransform" Value="rotate(180deg)"/>
			<Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
		</Style>

		<Style Selector="Path#Chevron">
			<Setter Property="Transitions">
				<Transitions>
					<TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.12" />
				</Transitions>
			</Setter>
		</Style>

	</UserControl.Styles>

	<ScrollViewer>
		<StackPanel Spacing="35" Margin="40">

			<!-- Header -->
			<StackPanel Spacing="5">
				<TextBlock Text="{DynamicResource SettingsView.Title}"
						   FontSize="32"
						   FontWeight="Bold"
						   Foreground="{DynamicResource Color.Accent}"/>
				<TextBlock Text="{DynamicResource SettingsView.Description}"
						   FontSize="14"
						   Opacity="0.5"/>
			</StackPanel>

			<!-- THEME dropdown -->
			<StackPanel Spacing="10">
				<ToggleButton x:Name="ThemeDrop"
							  Classes="DropdownButton"
							  IsChecked="False">
					<Grid ColumnDefinitions="Auto,*,Auto" VerticalAlignment="Center">
						<TextBlock Text="{DynamicResource SettingsView.Appearance.Title}"
								   Foreground="{DynamicResource Brush.Text.Primary}"
								   FontSize="18"
								   FontWeight="SemiBold"/>

						<TextBlock Grid.Column="1"
								   Text="{Binding SelectedTheme}"
								   Foreground="{DynamicResource Brush.Text.Secondary}"
								   HorizontalAlignment="Right"
								   Margin="12,0,12,0">
							
						</TextBlock>
			
					</Grid>
				</ToggleButton>

				<Border IsVisible="{Binding IsChecked, ElementName=ThemeDrop}"
						Background="{DynamicResource Brush.Surface}"
						CornerRadius="12"
						Padding="12"
						BorderBrush="{DynamicResource Brush.Outline}"
						BorderThickness="1">
					<ScrollViewer MaxHeight="220">
						<ListBox ItemsSource="{Binding AvailableThemes}"
								 SelectedItem="{Binding SelectedTheme}"
								 Background="Transparent"
								 BorderThickness="0">
							<ListBox.ItemTemplate>
								<DataTemplate x:DataType="styles:ThemeManager+AppTheme">
									<StackPanel Orientation="Horizontal" Spacing="10" Margin="6,8">
										<Ellipse Width="12"
												 Height="12"
												 Fill="{Binding Converter={StaticResource ThemeToColorConverter}}"/>
										<TextBlock Text="{Binding}"
												   Foreground="{DynamicResource Brush.Text.Primary}"
												   FontWeight="Medium"/>
									</StackPanel>
								</DataTemplate>
							</ListBox.ItemTemplate>
						</ListBox>
					</ScrollViewer>
				</Border>
			</StackPanel>

			<!-- LANGUAGE dropdown -->
			<StackPanel Spacing="10">
				<ToggleButton x:Name="LangDrop"
							  Classes="DropdownButton"
							  IsChecked="False">
					<Grid ColumnDefinitions="Auto,*,Auto" VerticalAlignment="Center">
						<TextBlock Text="{DynamicResource SettingsView.Translation.Title}"
								   Foreground="{DynamicResource Brush.Text.Primary}"
								   FontSize="18"
								   FontWeight="SemiBold"/>

						<TextBlock Grid.Column="1"
								   Text="{Binding SelectedLanguage}"
								   Foreground="{DynamicResource Brush.Text.Secondary}"
								   HorizontalAlignment="Right"
								   Margin="12,0,12,0"
								   TextTrimming="CharacterEllipsis"/>

						
					</Grid>
				</ToggleButton>

				<Border IsVisible="{Binding IsChecked, ElementName=LangDrop}"
						Background="{DynamicResource Brush.Surface}"
						CornerRadius="12"
						Padding="12"
						BorderBrush="{DynamicResource Brush.Outline}"
						BorderThickness="1">
					<ScrollViewer MaxHeight="220">
						<ListBox ItemsSource="{Binding AvailableLanguages}"
								 SelectedItem="{Binding SelectedLanguage}"
								 Background="Transparent"
								 BorderThickness="0">
							<ListBox.ItemTemplate>
								<DataTemplate x:DataType="translations:TranslationManager+AppLanguage">
									<TextBlock Text="{Binding}"
											   Foreground="{DynamicResource Brush.Text.Primary}"
											   FontWeight="Medium"
											   Margin="6,8"/>
								</DataTemplate>
							</ListBox.ItemTemplate>
						</ListBox>
					</ScrollViewer>
				</Border>
			</StackPanel>

			<!-- API -->
			<StackPanel Spacing="15">
				<TextBlock Text="{DynamicResource SettingsView.API.Title}"
						   FontSize="18"
						   FontWeight="SemiBold"
						   Foreground="{DynamicResource Brush.Text.Primary}"/>

				<Border Background="{DynamicResource Brush.Surface}" Padding="25" CornerRadius="15">
					<StackPanel Spacing="25">

						<StackPanel Spacing="8">
							<TextBlock Text="{DynamicResource SettingsView.API.Url}" FontSize="12" Opacity="0.6" Margin="5,0"/>

							<StackPanel Spacing="10">

								<TextBox Text="{Binding ApiUrl}"
										 CornerRadius="10"
										 VerticalContentAlignment="Center"
										 Watermark="https://..."
										 Height="42"/>

								<Button Content="{DynamicResource SettingsView.API.Test}"
										Command="{Binding TestConnectionCommand}"
										Height="42"
										CornerRadius="10"
										HorizontalContentAlignment="Center"
										VerticalContentAlignment="Center"
										BorderThickness="1"
										BorderBrush="{DynamicResource Brush.Background}"
										Background="{DynamicResource Brush.Success}"
										Foreground="{DynamicResource Brush.Text.Primary}"/>

								<ProgressBar IsIndeterminate="True"
											 IsVisible="{Binding IsTestingConnection}"
											 Height="2"
											 Background="Transparent"
											 Foreground="{DynamicResource Brush.Accent}"
											 Margin="2,-6,0,0"/>

								<TextBlock Text="{Binding StatusBoxText}"
										   Foreground="{DynamicResource Color.Error}"
										   Margin="2"
										   IsVisible="{Binding IsErrorVisible}"/>

								<TextBlock Text="{Binding StatusBoxText}"
										   Foreground="{DynamicResource Color.Success}"
										   Margin="2"
										   IsVisible="{Binding IsSuccessVisible}"/>

							</StackPanel>

							<StackPanel Spacing="8" Margin="0,10,0,0">
								<TextBlock Text="{DynamicResource SettingsView.API.RecentConnections}" FontSize="11" Opacity="0.4" Margin="5,0"/>

								<ScrollViewer HorizontalScrollBarVisibility="Auto"
											  VerticalScrollBarVisibility="Disabled">
									<ItemsControl ItemsSource="{Binding RecentApiUrls}">
										<ItemsControl.ItemsPanel>
											<ItemsPanelTemplate>
												<WrapPanel Orientation="Horizontal"/>
											</ItemsPanelTemplate>
										</ItemsControl.ItemsPanel>

										<ItemsControl.ItemTemplate>
											<DataTemplate>
												<Border Background="#1A2128"
														CornerRadius="15"
														Padding="10,4"
														Margin="0,0,8,8"
														BorderThickness="1"
														BorderBrush="{DynamicResource Brush.Outline}">
													<TextBlock Text="{Binding}" FontSize="11" Opacity="0.8"
															   Foreground="{DynamicResource Brush.Text.Primary}"/>
												</Border>
											</DataTemplate>
										</ItemsControl.ItemTemplate>
									</ItemsControl>
								</ScrollViewer>

							</StackPanel>
						</StackPanel>

						<StackPanel Spacing="8">
							<TextBlock Text="{DynamicResource SettingsView.API.UpdateFreq}" FontSize="12" Opacity="0.6" Margin="5,0"/>
							<NumericUpDown Value="{Binding RefreshIntervalSeconds}"
										   Width="180"
										   HorizontalAlignment="Left"
										   VerticalContentAlignment="Center"
										   Minimum="5"
										   Maximum="3600"/>
						</StackPanel>

					</StackPanel>
				</Border>
			</StackPanel>

		</StackPanel>
	</ScrollViewer>

</UserControl>
