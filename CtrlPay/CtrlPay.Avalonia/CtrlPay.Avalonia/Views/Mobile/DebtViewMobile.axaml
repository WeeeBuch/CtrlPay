<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:CtrlPay.Avalonia.ViewModels"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:ent="using:CtrlPay.Entities"
             x:DataType="vm:DebtViewModel"
             x:Class="CtrlPay.Avalonia.Views.Mobile.DebtViewMobile"
             mc:Ignorable="d"
             d:DesignWidth="390"
             d:DesignHeight="800"
             Background="{DynamicResource Color.Background}">

	<UserControl.Styles>

		<!-- Dropdown button (our own expander header) -->
		<Style Selector="ToggleButton.DropdownButton">
			<Setter Property="Background" Value="{DynamicResource Color.Surface}" />
			<Setter Property="BorderBrush" Value="{DynamicResource Color.Border}" />
			<Setter Property="BorderThickness" Value="1" />
			<Setter Property="CornerRadius" Value="10" />
			<Setter Property="Padding" Value="12" />
			<Setter Property="HorizontalContentAlignment" Value="Stretch" />
		</Style>

		<Style Selector="ToggleButton.DropdownButton:pointerover">
			<Setter Property="Background" Value="{DynamicResource Color.Accent}" />
		</Style>

		<!-- Rotate chevron when opened -->
		<Style Selector="ToggleButton.DropdownButton:checked Path#Chevron">
			<Setter Property="RenderTransform" Value="rotate(180deg)" />
			<Setter Property="RenderTransformOrigin" Value="0.5,0.5" />
		</Style>

		<Style Selector="Path#Chevron">
			<Setter Property="Transitions">
				<Transitions>
					<TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.12" />
				</Transitions>
			</Setter>
		</Style>

	</UserControl.Styles>

	<ScrollViewer>
		<StackPanel Margin="16" Spacing="14">

			<!-- Hledání -->
			<TextBox Watermark="{DynamicResource DebtView.Watermark.SearchBar}"
					 Height="40" />

			<!-- FILTERS / SORT: custom dropdown -->
			<StackPanel Spacing="10">
				<ToggleButton x:Name="FilterDrop"
							  Classes="DropdownButton"
							  IsChecked="False">

					<Grid ColumnDefinitions="*,Auto" VerticalAlignment="Center">
						<TextBlock Text="{DynamicResource DebtView.Sorting}"
								   FontWeight="Bold"
								   Opacity="0.9" />

					</Grid>
				</ToggleButton>

				<!-- content (shown when opened) -->
				<Border IsVisible="{Binding IsChecked, ElementName=FilterDrop}"
						Background="{DynamicResource Color.Surface}"
						BorderBrush="{DynamicResource Color.Border}"
						BorderThickness="1"
						CornerRadius="10"
						Padding="12">

					<StackPanel Spacing="12">

						<CheckBox Content="{DynamicResource DebtView.Payable}"
								  IsChecked="{Binding PayableChecked}" />

						<Border BorderBrush="{DynamicResource Color.Border}"
								BorderThickness="1"
								Padding="10"
								CornerRadius="8">

							<StackPanel Spacing="10">
								<TextBlock Text="{DynamicResource DebtView.Sorting}"
										   FontWeight="Bold"
										   Opacity="0.6"
										   Margin="0,0,0,5" />

								<!-- Sort options -->
								<ScrollViewer MaxHeight="220">
									<ListBox Background="Transparent"
											 BorderThickness="0"
											 SelectedItem="{Binding SelectedSortOrder}"
											 ItemsSource="{Binding SortOptions}">
										<ListBox.Styles>
											<Style Selector="ListBoxItem">
												<Setter Property="Padding" Value="10,8" />
												<Setter Property="Margin" Value="0,2" />
												<Setter Property="CornerRadius" Value="8" />
											</Style>
										</ListBox.Styles>

										<ListBox.ItemTemplate>
											<DataTemplate>
												<TextBlock Text="{Binding DisplayName}" />
											</DataTemplate>
										</ListBox.ItemTemplate>
									</ListBox>
								</ScrollViewer>
							</StackPanel>

						</Border>
					</StackPanel>
				</Border>
			</StackPanel>

			<!-- Seznam dluhů -->
			<ItemsControl ItemsSource="{Binding Debts}">
				<ItemsControl.ItemTemplate>
					<DataTemplate>

						<Border Background="{DynamicResource Color.Surface}"
								CornerRadius="12"
								Margin="0,0,0,12"
								BorderBrush="{DynamicResource Color.Border}"
								BorderThickness="1"
								ClipToBounds="True">

							<Border.Transitions>
								<Transitions>
									<DoubleTransition Property="Opacity" Duration="0:0:0.2"/>
								</Transitions>
							</Border.Transitions>

							<StackPanel>

								<!-- Klikací hlavička položky (rozbalování) -->
								<Button Command="{Binding ToggleExpandCommand}"
										Background="Transparent"
										BorderThickness="0"
										CornerRadius="12"
										HorizontalAlignment="Stretch"
										HorizontalContentAlignment="Stretch"
										Padding="16">

									<Button.Styles>
										<Style Selector="Button:pointerover /template/ ContentPresenter">
											<Setter Property="Background" Value="{DynamicResource Color.Accent}" />
										</Style>
									</Button.Styles>

									<Grid ColumnDefinitions="10,*,10"
										  RowDefinitions="Auto,Auto"
										  Margin="2">

										<Border Grid.Column="0"
												Grid.RowSpan="2"
												Classes="indicator"
												Tag="{Binding Status}"
												CornerRadius="2"
												Height="24"
												Width="4"
												HorizontalAlignment="Center"
												VerticalAlignment="Stretch"
												Margin="0,0,10,0"/>

										<TextBlock Grid.Column="1"
												   Grid.Row="0"
												   Text="{Binding Description}"
												   FontSize="16"
												   VerticalAlignment="Center"
												   Foreground="{DynamicResource Color.Text.Primary}"
												   TextTrimming="CharacterEllipsis"
												   MaxLines="2" />

										<StackPanel Grid.Column="1"
													Grid.Row="1"
													Orientation="Horizontal"
													VerticalAlignment="Center"
													Margin="0,8,0,0"
													Spacing="8">
											<TextBlock Text="{Binding Amount, StringFormat=\{0:N12\}}"
													   FontSize="18"
													   FontWeight="SemiBold" />
											<TextBlock Text="{DynamicResource App.Currency}"
													   VerticalAlignment="Bottom"
													   Opacity="0.7" />
										</StackPanel>

									</Grid>
								</Button>

								<!-- Rozbalený detail -->
								<Border IsVisible="{Binding IsExpanded}"
										Background="{DynamicResource Color.Surface}"
										Padding="16"
										BorderBrush="{DynamicResource Color.Border}"
										BorderThickness="0,1,0,0">

									<StackPanel Spacing="12">

										<StackPanel Spacing="8">
											<Button Content="{DynamicResource DebtView.PayFromCredit}"
													Command="{Binding PayFromCreditCommand}"
													Padding="15,8" />

											<TextBlock Text="{Binding CreditPayString}"
													   FontSize="12"
													   Opacity="0.55" />
										</StackPanel>

										<Button Content="{DynamicResource DebtView.GenerateAddress}"
												Command="{Binding GenerateAddressCommand}"
												Padding="15,8" />
									</StackPanel>

								</Border>
							</StackPanel>
						</Border>

					</DataTemplate>
				</ItemsControl.ItemTemplate>
			</ItemsControl>

		</StackPanel>
	</ScrollViewer>

</UserControl>
